<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#6366f1">
    <meta name="description" content="Track your disc golf rounds with detailed scoring, approach shots, and putts. View historical statistics for each hole.">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Disc Golf">

    <title>Disc Golf Tracker</title>

    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header id="app-header" class="header">
            <div class="header-left">
                <button id="back-btn" class="btn-icon hidden" aria-label="Go back">
                    <svg viewBox="0 0 24 24" width="24" height="24">
                        <path fill="currentColor" d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                    </svg>
                </button>
            </div>
            <h1 id="header-title" class="header-title" onclick="App.showScreen('home');">Disc Golf Tracker</h1>
            <div class="header-right">
                <div id="sync-status" class="sync-status hidden" title="Sync status">
                    <svg viewBox="0 0 24 24" width="20" height="20">
                        <path fill="currentColor" d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/>
                    </svg>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main id="main-content" class="main-content" role="main">
            <!-- Setup Wizard Screen -->
            <div id="screen-setup" class="screen">
                <div class="screen-content">
                    <div class="setup-wizard">
                        <div class="setup-header">
                            <div class="app-logo">
                                <svg viewBox="0 0 100 100" width="64" height="64">
                                    <circle cx="50" cy="50" r="45" fill="#1a1a2e"/>
                                    <ellipse cx="50" cy="32" rx="22" ry="8" fill="none" stroke="#6366f1" stroke-width="3"/>
                                    <path d="M28 32 L40 52 M38 32 L45 52 M50 40 L50 52 M62 32 L55 52 M72 32 L60 52" stroke="#6366f1" stroke-width="2" opacity="0.7"/>
                                    <ellipse cx="50" cy="52" rx="18" ry="6" fill="none" stroke="#6366f1" stroke-width="3"/>
                                    <rect x="47" y="52" width="6" height="25" fill="#6366f1"/>
                                    <ellipse cx="50" cy="77" rx="12" ry="4" fill="#6366f1"/>
                                </svg>
                            </div>
                            <h2>Setup Required</h2>
                            <p class="setup-intro">Connect a Google Sheet to store your data</p>
                        </div>

                        <ol class="setup-steps">
                            <li>Create a new Google Sheet</li>
                            <li>
                                Share it with:
                                <code id="service-account-email" class="service-email">sheets-db-api@kinetic-object-322814.iam.gserviceaccount.com</code>
                                <span class="share-note">(Editor access)</span>
                            </li>
                            <li>Copy the Sheet ID from the URL
                                <span class="setup-hint">The ID is the long string between /d/ and /edit in the URL</span>
                            </li>
                            <li>Paste below and click Connect</li>
                        </ol>

                        <div class="setup-input-group">
                            <input type="text" id="setup-sheet-id"
                                   placeholder="Paste your Google Sheet ID here"
                                   autocomplete="off">
                            <button id="setup-connect-btn" class="btn btn-primary btn-large">
                                Connect
                            </button>
                        </div>

                        <div id="setup-status" class="setup-status hidden"></div>
                    </div>
                </div>
            </div>

            <!-- Home Screen -->
            <div id="screen-home" class="screen">
                <div class="home-container">
                    <div class="logo-section">
                        <div class="app-logo">
                            <svg viewBox="0 0 100 100" width="80" height="80">
                                <circle cx="50" cy="50" r="45" fill="#1a1a2e"/>
                                <ellipse cx="50" cy="32" rx="22" ry="8" fill="none" stroke="#6366f1" stroke-width="3"/>
                                <path d="M28 32 L40 52 M38 32 L45 52 M50 40 L50 52 M62 32 L55 52 M72 32 L60 52" stroke="#6366f1" stroke-width="2" opacity="0.7"/>
                                <ellipse cx="50" cy="52" rx="18" ry="6" fill="none" stroke="#6366f1" stroke-width="3"/>
                                <rect x="47" y="52" width="6" height="25" fill="#6366f1"/>
                                <ellipse cx="50" cy="77" rx="12" ry="4" fill="#6366f1"/>
                            </svg>
                        </div>
                        <h2>Disc Golf Tracker</h2>
                        <p class="tagline">Track your rounds. Improve your game.</p>
                    </div>

                    <div id="main-actions" class="main-actions" role="group" aria-label="Main actions">
                        <button id="new-round-btn" class="btn btn-primary btn-large" aria-label="Start a new round">
                            <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true">
                                <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                            </svg>
                            New Round
                        </button>

                        <button id="resume-round-btn" class="btn btn-secondary btn-large hidden" aria-label="Resume incomplete round">
                            <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true">
                                <path fill="currentColor" d="M8 5v14l11-7z"/>
                            </svg>
                            Resume Round
                        </button>
                    </div>

                    <button id="settings-btn" class="btn btn-text settings-link" aria-label="Settings">
                        <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
                            <path fill="currentColor" d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
                        </svg>
                        Settings
                    </button>

                    <div id="offline-indicator" class="offline-indicator hidden">
                        <svg viewBox="0 0 24 24" width="16" height="16">
                            <path fill="currentColor" d="M23.64 7c-.45-.34-4.93-4-11.64-4-1.5 0-2.89.19-4.15.48L18.18 13.8 23.64 7zm-6.6 8.22L3.27 1.44 2 2.72l2.05 2.06C1.91 5.76.59 6.82.36 7L12 21.5l3.07-3.94 4.01 4.01 1.27-1.27-3.31-3.08z"/>
                        </svg>
                        Offline Mode
                    </div>

                </div>
            </div>

            <!-- Course Selection Screen -->
            <div id="screen-course-select" class="screen">
                <div class="screen-content">
                    <div class="course-select-header">
                        <h2>Select Course</h2>
                        <p>Choose an existing course or create a new one</p>
                    </div>

                    <button id="create-course-btn" class="btn btn-outline course-card create-course-card" aria-label="Create a new course">
                        <svg viewBox="0 0 24 24" width="32" height="32" aria-hidden="true">
                            <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                        </svg>
                        <span>Create New Course</span>
                    </button>

                    <div id="course-list" class="course-list" role="list" aria-label="Available courses">
                        <!-- Course cards will be dynamically inserted here -->
                    </div>

                    <div id="no-courses-message" class="empty-state hidden">
                        <p>No courses yet. Create your first course to get started!</p>
                    </div>
                </div>
            </div>

            <!-- New Course Screen -->
            <div id="screen-new-course" class="screen">
                <div class="screen-content">
                    <h2>Create New Course</h2>

                    <form id="new-course-form" class="form">
                        <div class="form-group">
                            <label for="course-name">Course Name</label>
                            <input type="text" id="course-name" name="course-name"
                                   placeholder="e.g., Morley Field"
                                   maxlength="100" required
                                   autocomplete="off">
                            <span class="error-message" id="course-name-error"></span>
                        </div>

                        <div class="form-group">
                            <label for="hole-count">Number of Holes</label>
                            <div class="number-input-group" role="group" aria-label="Hole count stepper">
                                <button type="button" class="btn-stepper" data-action="decrement" data-target="hole-count" aria-label="Decrease hole count">-</button>
                                <input type="number" id="hole-count" name="hole-count"
                                       value="18" min="1" max="27" required aria-describedby="hole-count-error">
                                <button type="button" class="btn-stepper" data-action="increment" data-target="hole-count" aria-label="Increase hole count">+</button>
                            </div>
                            <span class="error-message" id="hole-count-error" role="alert"></span>
                        </div>

                        <button type="submit" class="btn btn-primary btn-large">Start Round</button>
                    </form>
                </div>
            </div>

            <!-- Hole Scoring Screen -->
            <div id="screen-scoring" class="screen">
                <div class="screen-content scoring-screen">
                    <!-- Hole Navigation -->
                    <nav class="hole-nav" role="navigation" aria-label="Hole navigation">
                        <button id="prev-hole-btn" class="btn-icon" aria-label="Go to previous hole" disabled>
                            <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true">
                                <path fill="currentColor" d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                            </svg>
                        </button>
                        <div class="hole-indicator" aria-live="polite" aria-atomic="true">
                            <span id="current-hole-label">Hole 1</span>
                            <span id="hole-count-label">of 18</span>
                        </div>
                        <button id="next-hole-btn" class="btn-icon" aria-label="Go to next hole">
                            <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true">
                                <path fill="currentColor" d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
                            </svg>
                        </button>
                    </nav>

                    <!-- Hole Info (for existing courses) -->
                    <div id="hole-info" class="hole-info hidden">
                        <div class="info-chip">
                            <span class="info-label">Par</span>
                            <span id="hole-par-display" class="info-value">3</span>
                        </div>
                        <div class="info-chip" id="distance-chip">
                            <span class="info-label">Distance</span>
                            <span id="hole-distance-display" class="info-value">285 ft</span>
                        </div>
                    </div>

                    <!-- Statistics Section (for existing courses with history) -->
                    <section id="stats-section" class="stats-section hidden" aria-label="Your hole statistics">
                        <h3>Your Averages</h3>
                        <div class="stats-grid" role="group" aria-label="Average statistics">
                            <div class="stat-item">
                                <span class="stat-label" id="avg-score-label">Score</span>
                                <span id="avg-score" class="stat-value" aria-labelledby="avg-score-label">--</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label" id="avg-approaches-label">Approaches</span>
                                <span id="avg-approaches" class="stat-value" aria-labelledby="avg-approaches-label">--</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label" id="avg-putts-label">Putts</span>
                                <span id="avg-putts" class="stat-value" aria-labelledby="avg-putts-label">--</span>
                            </div>
                        </div>
                    </section>

                    <!-- Course Setup Section (for new courses) -->
                    <section id="hole-setup" class="hole-setup hidden" aria-label="Hole setup">
                        <h3>Hole Details</h3>
                        <div class="setup-grid">
                            <div class="form-group">
                                <label for="setup-par">Par</label>
                                <div class="number-input-group" role="group" aria-label="Par stepper">
                                    <button type="button" class="btn-stepper" data-action="decrement" data-target="setup-par" aria-label="Decrease par">-</button>
                                    <input type="number" id="setup-par" name="setup-par"
                                           value="3" min="2" max="6" aria-label="Par value">
                                    <button type="button" class="btn-stepper" data-action="increment" data-target="setup-par" aria-label="Increase par">+</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="setup-distance">Distance (ft) <span class="optional">optional</span></label>
                                <input type="number" id="setup-distance" name="setup-distance"
                                       placeholder="285" min="0" max="1500" aria-label="Hole distance in feet">
                            </div>
                        </div>
                    </section>

                    <!-- Score Entry Section -->
                    <section class="score-entry" aria-label="Score entry">
                        <h3>Your Score</h3>
                        <div class="score-input-container">
                            <div class="form-group score-group">
                                <label for="score-throws">Throws</label>
                                <div class="number-input-group large" role="group" aria-label="Throws stepper">
                                    <button type="button" class="btn-stepper large" data-action="decrement" data-target="score-throws" aria-label="Decrease throws">-</button>
                                    <input type="number" id="score-throws" name="score-throws"
                                           value="3" min="1" max="20" aria-label="Number of throws" aria-describedby="score-relative">
                                    <button type="button" class="btn-stepper large" data-action="increment" data-target="score-throws" aria-label="Increase throws">+</button>
                                </div>
                                <div id="score-relative" class="score-relative" aria-live="polite" aria-atomic="true">E</div>
                            </div>
                        </div>

                        <div class="detail-scores">
                            <div class="form-group">
                                <label for="score-approaches">Approaches <span class="optional">optional</span></label>
                                <div class="number-input-group" role="group" aria-label="Approaches stepper">
                                    <button type="button" class="btn-stepper" data-action="decrement" data-target="score-approaches" aria-label="Decrease approaches">-</button>
                                    <input type="number" id="score-approaches" name="score-approaches"
                                           value="" min="0" max="19" placeholder="0" aria-label="Number of approach shots">
                                    <button type="button" class="btn-stepper" data-action="increment" data-target="score-approaches" aria-label="Increase approaches">+</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="score-putts">Putts <span class="optional">optional</span></label>
                                <div class="number-input-group" role="group" aria-label="Putts stepper">
                                    <button type="button" class="btn-stepper" data-action="decrement" data-target="score-putts" aria-label="Decrease putts">-</button>
                                    <input type="number" id="score-putts" name="score-putts"
                                           value="" min="0" max="19" placeholder="0" aria-label="Number of putts">
                                    <button type="button" class="btn-stepper" data-action="increment" data-target="score-putts" aria-label="Increase putts">+</button>
                                </div>
                            </div>
                        </div>

                        <div id="validation-warning" class="validation-warning hidden" role="alert" aria-live="polite">
                            <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
                                <path fill="currentColor" d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
                            </svg>
                            <span id="validation-message"></span>
                        </div>
                    </section>
                </div>

                <!-- Fixed Bottom Action -->
                <div class="bottom-action">
                    <button id="save-hole-btn" class="btn btn-primary btn-large" aria-label="Save score and go to next hole">
                        Next Hole
                        <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true">
                            <path fill="currentColor" d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Round Summary Screen -->
            <div id="screen-summary" class="screen">
                <div class="screen-content">
                    <div class="summary-header">
                        <div class="check-icon">
                            <svg viewBox="0 0 24 24" width="48" height="48">
                                <path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                            </svg>
                        </div>
                        <h2>Round Complete!</h2>
                    </div>

                    <div class="summary-card">
                        <div class="summary-course-name" id="summary-course"></div>
                        <div class="summary-date" id="summary-date"></div>

                        <div class="summary-score">
                            <div class="total-score" id="summary-total-score">62</div>
                            <div class="relative-score" id="summary-relative-score">+8</div>
                        </div>

                        <div class="summary-details">
                            <div class="summary-detail">
                                <span class="detail-label">Holes Played</span>
                                <span class="detail-value" id="summary-holes">18</span>
                            </div>
                            <div class="summary-detail">
                                <span class="detail-label">Total Par</span>
                                <span class="detail-value" id="summary-par">54</span>
                            </div>
                        </div>
                    </div>

                    <div id="summary-comparison" class="summary-comparison hidden">
                        <h3>Compared to Average</h3>
                        <div class="comparison-result" id="comparison-result"></div>
                    </div>

                    <div id="summary-highlights" class="summary-highlights hidden">
                        <div class="highlight-section">
                            <h4>Best Holes</h4>
                            <div id="best-holes" class="highlight-list"></div>
                        </div>
                        <div class="highlight-section">
                            <h4>Needs Work</h4>
                            <div id="worst-holes" class="highlight-list"></div>
                        </div>
                    </div>

                    <div class="summary-actions">
                        <button id="view-scorecard-btn" class="btn btn-outline">View Scorecard</button>
                        <button id="finish-round-btn" class="btn btn-primary btn-large">Save & Finish</button>
                    </div>
                </div>
            </div>

            <!-- Settings Screen -->
            <div id="screen-settings" class="screen">
                <div class="screen-content">
                    <h2>Settings</h2>

                    <section class="settings-section">
                        <h3>Google Sheets Connection</h3>

                        <div id="settings-connected" class="settings-connected">
                            <div class="connection-status">
                                <span class="status-badge connected">
                                    <svg viewBox="0 0 24 24" width="16" height="16">
                                        <path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                                    </svg>
                                    Connected
                                </span>
                            </div>
                            <a id="settings-sheet-link" href="#" target="_blank" rel="noopener noreferrer" class="sheet-link">
                                <svg viewBox="0 0 24 24" width="16" height="16">
                                    <path fill="currentColor" d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/>
                                </svg>
                                Open Spreadsheet
                            </a>
                            <button id="change-sheet-btn" class="btn btn-outline">
                                Change Spreadsheet
                            </button>
                        </div>

                        <div id="settings-edit" class="settings-edit hidden">
                            <p class="settings-edit-note">Enter a new Google Sheet ID. Make sure to share it with:</p>
                            <code class="service-email">sheets-db-api@kinetic-object-322814.iam.gserviceaccount.com</code>
                            <span class="share-note">(Editor access)</span>

                            <div class="settings-input-group">
                                <input type="text" id="settings-sheet-id"
                                       placeholder="Paste your Google Sheet ID here"
                                       autocomplete="off">
                            </div>

                            <div class="settings-actions">
                                <button id="settings-cancel-btn" class="btn btn-outline">
                                    Cancel
                                </button>
                                <button id="settings-save-btn" class="btn btn-primary">
                                    Save & Connect
                                </button>
                            </div>

                            <div id="settings-status" class="setup-status hidden"></div>
                        </div>
                    </section>
                </div>
            </div>

            <!-- Scorecard Modal -->
            <div id="scorecard-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="scorecard-modal-title">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 id="scorecard-modal-title">Scorecard</h2>
                        <button id="close-scorecard-btn" class="btn-icon" aria-label="Close scorecard">
                            <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true">
                                <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                            </svg>
                        </button>
                    </div>
                    <div class="modal-body">
                        <table id="scorecard-table" class="scorecard-table">
                            <thead>
                                <tr>
                                    <th>Hole</th>
                                    <th>Par</th>
                                    <th>Score</th>
                                    <th>+/-</th>
                                    <th>App</th>
                                    <th>Putts</th>
                                </tr>
                            </thead>
                            <tbody id="scorecard-body">
                                <!-- Rows will be dynamically inserted -->
                            </tbody>
                            <tfoot id="scorecard-footer">
                                <!-- Totals will be dynamically inserted -->
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Incomplete Round Modal -->
            <div id="incomplete-round-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="incomplete-round-title" aria-describedby="incomplete-round-message">
                <div class="modal-content modal-small">
                    <h2 id="incomplete-round-title">Incomplete Round</h2>
                    <p id="incomplete-round-message">You have an incomplete round. Would you like to continue or start a new round?</p>
                    <div class="modal-actions">
                        <button id="continue-round-btn" class="btn btn-primary" aria-label="Continue the incomplete round">Continue Round</button>
                        <button id="abandon-round-btn" class="btn btn-outline btn-danger" aria-label="Abandon the incomplete round and start a new one">Abandon & Start New</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="loading-overlay hidden" role="alert" aria-live="assertive" aria-busy="true">
            <div class="spinner" aria-hidden="true"></div>
            <p id="loading-message">Loading...</p>
        </div>

        <!-- Toast Notifications -->
        <div id="toast-container" class="toast-container" role="status" aria-live="polite" aria-atomic="true"></div>
    </div>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FWHGTTV1VH"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-FWHGTTV1VH');
    </script>

    <!-- Application Scripts -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/sheets-api.js"></script>
    <script src="js/statistics.js"></script>
    <script src="js/app.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registered:', registration.scope);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }
    </script>

</body>
</html>
